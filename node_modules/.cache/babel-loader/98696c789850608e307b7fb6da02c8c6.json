{"remainingRequest":"/Users/jiwon/test/matching-frontend/node_modules/babel-loader/lib/index.js!/Users/jiwon/test/matching-frontend/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/jiwon/test/matching-frontend/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jiwon/test/matching-frontend/src/components/ChatRoom/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jiwon/test/matching-frontend/src/components/ChatRoom/index.vue","mtime":1660723902423},{"path":"/Users/jiwon/test/matching-frontend/babel.config.js","mtime":1660723455491},{"path":"/Users/jiwon/test/matching-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1660264744188},{"path":"/Users/jiwon/test/matching-frontend/node_modules/babel-loader/lib/index.js","mtime":1652941041233},{"path":"/Users/jiwon/test/matching-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1660264744188},{"path":"/Users/jiwon/test/matching-frontend/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1660264748190}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IFNvY2tKUyBmcm9tICJzb2NranMtY2xpZW50IjsKaW1wb3J0IFN0b21wIGZyb20gIndlYnN0b21wLWNsaWVudCI7CmltcG9ydCBkYXlqcyBmcm9tICJkYXlqcyI7CmltcG9ydCB7IGZldGNoUGFja1VzZXJBbmRNeURhdGEgfSBmcm9tICIuL193b3JrZXIvdXNlciI7CmltcG9ydCB7IHVzZUFwcFN0b3JlIH0gZnJvbSAiQC9zdG9yZS91c2VyU3RhdGUiOwppbXBvcnQgQ2hhdFJvb21NeVByb2ZpbGUgZnJvbSAiLi9fY29tcG9uZW50cy9DaGF0Um9vbU15UHJvZmlsZS52dWUiOwppbXBvcnQgQ2hhdFJvb21EYXRlRGl2aWRlciBmcm9tICIuL19jb21wb25lbnRzL0NoYXRSb29tRGF0ZURpdmlkZXIudnVlIjsKaW1wb3J0IENoYXRSb29tTWVzc2FnZUJveCBmcm9tICIuL19jb21wb25lbnRzL0NoYXRSb29tTWVzc2FnZUJveC52dWUiOwppbXBvcnQgQ2hhdFJvb21NZXNzYWdlSW5wdXQgZnJvbSAiLi9fY29tcG9uZW50cy9DaGF0Um9vbU1lc3NhZ2VJbnB1dC52dWUiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkNoYXRSb29tIiwKCiAgc2V0dXAoKSB7CiAgICBjb25zdCBzdG9yZSA9IHVzZUFwcFN0b3JlKCk7CiAgICByZXR1cm4gewogICAgICBzdG9yZQogICAgfTsKICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgLy8gZHVtbXlUdXJuOiAwLAogICAgICAvLyBkdW1teUlkOiBwcmV2RGF0YS5sZW5ndGgsCiAgICAgIG1lc3NhZ2VzOiBbXSwKICAgICAgdXNlcjoge30sCiAgICAgIHJlY2VpdmVyOiB7fSwKICAgICAgc2hvd01vcmU6IGZhbHNlCiAgICB9OwogIH0sCgogIG1vdW50ZWQoKSB7CiAgICB0aGlzLnByZXBhcmVVc2VyKHsKICAgICAgdXNlcklkOiAidXNlcjUiLAogICAgICByZWNlaXZlcklkOiAidXNlcjEzMSIKICAgIH0pOwogIH0sCgogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmNvbm5lY3RTb2NrZXQoKTsKICB9LAoKICB3YXRjaDogewogICAgdXNlcigpIHsKICAgICAgY29uc29sZS5sb2codGhpcy51c2VyKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogIH0sCiAgY29tcG9uZW50czogewogICAgQ2hhdFJvb21NeVByb2ZpbGUsCiAgICBDaGF0Um9vbU1lc3NhZ2VCb3gsCiAgICBDaGF0Um9vbURhdGVEaXZpZGVyLAogICAgQ2hhdFJvb21NZXNzYWdlSW5wdXQKICB9LAogIG1ldGhvZHM6IHsKICAgIGFzeW5jIHByZXBhcmVVc2VyKHsKICAgICAgdXNlcklkLAogICAgICByZWNlaXZlcklkCiAgICB9KSB7CiAgICAgIHRoaXMudXNlciA9IGF3YWl0IGZldGNoUGFja1VzZXJBbmRNeURhdGEodXNlcklkKTsKICAgICAgdGhpcy5yZWNlaXZlciA9IGF3YWl0IGZldGNoUGFja1VzZXJBbmRNeURhdGEocmVjZWl2ZXJJZCk7CiAgICAgIGNvbnNvbGUubG9nKHRoaXMudXNlci51c2VyLnVzZXJJZCwgdGhpcy5yZWNlaXZlci51c2VyLnVzZXJJZCk7CiAgICB9LAoKICAgIGFkZFNlbnRNZXNzYWdlKHNlbnRNZXNzYWdlQ29udGVudCkgewogICAgICBjb25zdCB7CiAgICAgICAgdXNlcklkCiAgICAgIH0gPSB0aGlzLnVzZXIudXNlcjsKICAgICAgY29uc3QgbWF0Y2hJZCA9IDE1OwogICAgICBjb25zdCBtZXNzYWdlID0gewogICAgICAgIG1hdGNoSWQsCiAgICAgICAgdXNlcklkLAogICAgICAgIGNvbnRlbnQ6IHNlbnRNZXNzYWdlQ29udGVudCwKICAgICAgICBjcmVhdGVkRGF0ZTogZGF5anMoKS5mb3JtYXQoIllZWVlNTURESEhtbXNzIikKICAgICAgfTsKICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKHsgLi4ubWVzc2FnZSwKICAgICAgICBtZXNzYWdlSWQ6IHRoaXMubWVzc2FnZXMgPyB0aGlzLm1lc3NhZ2VzLmxlbmd0aCA6IDAKICAgICAgfSk7CiAgICAgIHRoaXMuc3RvbXBDbGllbnQuc2VuZChgL2FwcC9jaGF0LnNlbmRNZXNzYWdlLyR7bWF0Y2hJZH1gLCBKU09OLnN0cmluZ2lmeShtZXNzYWdlKSwge30pOwogICAgfSwKCiAgICBjb25uZWN0U29ja2V0KCkgewogICAgICBjb25zdCBDSEFUX1RBUkdFVCA9ICJodHRwOi8vbWF0Y2hpbmcuMTY5LjU2LjEwMC4xMDQubmlwLmlvL3dlYnNvY2tldC1zZXJ2ZXIvd3MiOwogICAgICBjb25zdCBtYXRjaElkID0gMTsKICAgICAgY29uc3QgY2hhdFNvY2tldCA9IG5ldyBTb2NrSlMoQ0hBVF9UQVJHRVQpOwogICAgICB0aGlzLnN0b21wQ2xpZW50ID0gU3RvbXAub3ZlcihjaGF0U29ja2V0KTsKICAgICAgY29uc29sZS5sb2coQ0hBVF9UQVJHRVQpOwogICAgICB0aGlzLnN0b21wQ2xpZW50LmNvbm5lY3Qoe30sICgpID0+IHsKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IHRydWU7CiAgICAgICAgdGhpcy5zdG9tcENsaWVudC5zdWJzY3JpYmUoYC90b3BpYy8ke21hdGNoSWR9YCwgcmVzID0+IHsKICAgICAgICAgIGNvbnN0IHJlY2VpdmVkTWVzc2FnZSA9IEpTT04ucGFyc2UocmVzLmJvZHkpOwogICAgICAgICAgY29uc29sZS5sb2cocmVjZWl2ZWRNZXNzYWdlKTsKCiAgICAgICAgICBpZiAocmVjZWl2ZWRNZXNzYWdlLnVzZXJJZCAhPT0gdXNlci51c2VySWQpIHsKICAgICAgICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKHJlY2VpdmVkTWVzc2FnZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sICgpID0+IHsKICAgICAgICBjb25zb2xlLmxvZygiRkFJTEVEIik7CiAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9CgogIH0KfTs="},{"version":3,"mappings":"AAiCA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;EACAA,gBADA;;EAEAC;IACA;IACA;MAAAC;IAAA;EACA,CALA;;EAMAC;IACA;MACA;MACA;MACAC,YAHA;MAIAC,QAJA;MAKAC,YALA;MAMAC;IANA;EAQA,CAfA;;EAgBAC;IACA;MAAAC;MAAAC;IAAA;EACA,CAlBA;;EAmBAC;IACA;EACA,CArBA;;EAsBAC;IACAP;MACAQ;MACA;IACA;;EAJA,CAtBA;EA4BAC;IACAC,iBADA;IAEAC,kBAFA;IAGAC,mBAHA;IAIAC;EAJA,CA5BA;EAkCAC;IACA;MAAAV;MAAAC;IAAA;MACA;MACA;MACAG;IACA,CALA;;IAMAO;MACA;QAAAX;MAAA;MACA;MACA;QACAY,OADA;QAEAZ,MAFA;QAGAa,2BAHA;QAIAC;MAJA;MAOA,qBACA,UADA;QAEAC;MAFA;MAIA,sBACA,kCADA,EAEAC,uBAFA,EAGA,EAHA;IAKA,CAzBA;;IA0BAC;MACA,oBACA,2DADA;MAEA;MAEA;MAEA;MAEAb;MAEA,yBACA,EADA,EAEA;QACA;QAEA;UACA;UACAA;;UACA;YACA;UACA;QACA,CANA;MAOA,CAZA,EAaA;QACAA;QACA;MACA,CAhBA;IAkBA;;EAvDA;AAlCA","names":["name","setup","store","data","messages","user","receiver","showMore","mounted","userId","receiverId","created","watch","console","components","ChatRoomMyProfile","ChatRoomMessageBox","ChatRoomDateDivider","ChatRoomMessageInput","methods","addSentMessage","matchId","content","createdDate","messageId","JSON","connectSocket"],"sourceRoot":"src/components/ChatRoom","sources":["index.vue"],"sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <ChatRoomMyProfile :user=\"receiver\" />\n    <main>\n      <div class=\"messages\">\n        <div\n          class=\"message-wrapper\"\n          v-for=\"message in this.messages\"\n          :key=\"message.messageId\"\n        >\n          <ChatRoomDateDivider\n            v-if=\"\n              message.messageId === 0 ||\n              messages[message.messageId - 1].createdDate.slice(0, 8) !==\n                message.createdDate.slice(0, 8)\n            \"\n            :date=\"message.createdDate\"\n          />\n          <div class=\"box-wrapper\">\n            <ChatRoomMessageBox\n              :message=\"message\"\n              :onLeft=\"message.userId === receiver.userId\"\n            />\n            <!-- <ChatRoomTimeIndicator :date=\"message.createdDate\" /> -->\n          </div>\n        </div>\n      </div>\n      <ChatRoomMessageInput @sentMessageContent=\"addSentMessage\" />\n    </main>\n  </div>\n</template>\n\n<script>\nimport SockJS from \"sockjs-client\";\nimport Stomp from \"webstomp-client\";\nimport dayjs from \"dayjs\";\n\nimport { fetchPackUserAndMyData } from \"./_worker/user\";\nimport { useAppStore } from \"@/store/userState\";\nimport ChatRoomMyProfile from \"./_components/ChatRoomMyProfile.vue\";\nimport ChatRoomDateDivider from \"./_components/ChatRoomDateDivider.vue\";\nimport ChatRoomMessageBox from \"./_components/ChatRoomMessageBox.vue\";\nimport ChatRoomMessageInput from \"./_components/ChatRoomMessageInput.vue\";\n\nexport default {\n  name: \"ChatRoom\",\n  setup() {\n    const store = useAppStore();\n    return { store };\n  },\n  data() {\n    return {\n      // dummyTurn: 0,\n      // dummyId: prevData.length,\n      messages: [],\n      user: {},\n      receiver: {},\n      showMore: false,\n    };\n  },\n  mounted() {\n    this.prepareUser({ userId: \"user5\", receiverId: \"user131\" });\n  },\n  created() {\n    this.connectSocket();\n  },\n  watch: {\n    user() {\n      console.log(this.user);\n      return null;\n    },\n  },\n  components: {\n    ChatRoomMyProfile,\n    ChatRoomMessageBox,\n    ChatRoomDateDivider,\n    ChatRoomMessageInput,\n  },\n  methods: {\n    async prepareUser({ userId, receiverId }) {\n      this.user = await fetchPackUserAndMyData(userId);\n      this.receiver = await fetchPackUserAndMyData(receiverId);\n      console.log(this.user.user.userId, this.receiver.user.userId);\n    },\n    addSentMessage(sentMessageContent) {\n      const { userId } = this.user.user;\n      const matchId = 15;\n      const message = {\n        matchId,\n        userId,\n        content: sentMessageContent,\n        createdDate: dayjs().format(\"YYYYMMDDHHmmss\"),\n      };\n\n      this.messages.push({\n        ...message,\n        messageId: this.messages ? this.messages.length : 0,\n      });\n      this.stompClient.send(\n        `/app/chat.sendMessage/${matchId}`,\n        JSON.stringify(message),\n        {},\n      );\n    },\n    connectSocket() {\n      const CHAT_TARGET =\n        \"http://matching.169.56.100.104.nip.io/websocket-server/ws\";\n      const matchId = 1;\n\n      const chatSocket = new SockJS(CHAT_TARGET);\n\n      this.stompClient = Stomp.over(chatSocket);\n\n      console.log(CHAT_TARGET);\n\n      this.stompClient.connect(\n        {},\n        () => {\n          this.connected = true;\n\n          this.stompClient.subscribe(`/topic/${matchId}`, (res) => {\n            const receivedMessage = JSON.parse(res.body);\n            console.log(receivedMessage);\n            if (receivedMessage.userId !== user.userId) {\n              this.messages.push(receivedMessage);\n            }\n          });\n        },\n        () => {\n          console.log(\"FAILED\");\n          this.connected = false;\n        },\n      );\n    },\n  },\n};\n</script>\n\n<style scoped>\n.wrapper {\n  width: 100vw;\n  height: 100%;\n  overflow: hidden;\n}\n\nmain {\n  height: calc(100% - 58px);\n  overflow-y: scroll;\n}\n\n.message-wrapper {\n  width: 90%;\n  margin: 0 auto;\n}\n\n.messages {\n  height: calc(100% - 126px);\n}\n\nh1 {\n  margin: 7px 0;\n}\n</style>\n"]}]}