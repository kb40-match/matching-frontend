{"remainingRequest":"/Users/jiwon/test/matching-frontend/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jiwon/test/matching-frontend/src/components/ChatRoom/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jiwon/test/matching-frontend/src/components/ChatRoom/index.vue","mtime":1660723455654},{"path":"/Users/jiwon/test/matching-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1660264744188},{"path":"/Users/jiwon/test/matching-frontend/node_modules/babel-loader/lib/index.js","mtime":1652941041233},{"path":"/Users/jiwon/test/matching-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1660264744188},{"path":"/Users/jiwon/test/matching-frontend/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1660264748190}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBTb2NrSlMgZnJvbSAic29ja2pzLWNsaWVudCI7CmltcG9ydCBTdG9tcCBmcm9tICJ3ZWJzdG9tcC1jbGllbnQiOwppbXBvcnQgZGF5anMgZnJvbSAiZGF5anMiOwoKLy8gaW1wb3J0IHsgcHJldkRhdGEsIHVzZXIsIHJlY2VpdmVyIH0gZnJvbSAiLi9fd29ya2VyL2FwaSI7CmltcG9ydCB7IHVzZVVzZXJTdG9yZSB9IGZyb20gIkAvc3RvcmUvc3RhdGVzL3VzZXJTdGF0ZSI7Ci8vIGltcG9ydCB7IGxvYWRVc2VyQW5kTXlEYXRhIH0gZnJvbSAiQC93b3JrZXIvdXNlciI7Ci8vIGltcG9ydCB7IGZldGNoUHJldkxpc3QgfSBmcm9tICIuL193b3JrZXIvYXBpIjsKLy8gaW1wb3J0IHsgcHJlcGFyZVVzZXIgfSBmcm9tICIuL193b3JrZXIvdXNlciI7CmltcG9ydCB7IGZldGNoUGFja1VzZXJBbmRNeURhdGEgfSBmcm9tICIuL193b3JrZXIvdXNlciI7CmltcG9ydCBDaGF0Um9vbU15UHJvZmlsZSBmcm9tICIuL19jb21wb25lbnRzL0NoYXRSb29tTXlQcm9maWxlLnZ1ZSI7CmltcG9ydCBDaGF0Um9vbURhdGVEaXZpZGVyIGZyb20gIi4vX2NvbXBvbmVudHMvQ2hhdFJvb21EYXRlRGl2aWRlci52dWUiOwppbXBvcnQgQ2hhdFJvb21NZXNzYWdlQm94IGZyb20gIi4vX2NvbXBvbmVudHMvQ2hhdFJvb21NZXNzYWdlQm94LnZ1ZSI7CmltcG9ydCBDaGF0Um9vbU1lc3NhZ2VJbnB1dCBmcm9tICIuL19jb21wb25lbnRzL0NoYXRSb29tTWVzc2FnZUlucHV0LnZ1ZSI7Ci8vIGltcG9ydCB7IGZldGNoTXlEYXRhLCBmZXRjaFVzZXIgfSBmcm9tICIuLi8uLi93b3JrZXIvdXNlciI7Ci8vIGltcG9ydCBDaGF0Um9vbVRpbWVJbmRpY2F0b3IgZnJvbSAiLi9fY29tcG9uZW50cy9DaGF0Um9vbVRpbWVJbmRpY2F0b3IudnVlIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQ2hhdFJvb20iLAogIHNldHVwKCkgewogICAgY29uc3Qgc3RvcmUgPSB1c2VVc2VyU3RvcmUoKTsKICAgIHJldHVybiB7IHN0b3JlIH07CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgLy8gZHVtbXlUdXJuOiAwLAogICAgICAvLyBkdW1teUlkOiBwcmV2RGF0YS5sZW5ndGgsCiAgICAgIG1lc3NhZ2VzOiBbXSwKICAgICAgdXNlcjoge30sCiAgICAgIHJlY2VpdmVyOiB7fSwKICAgICAgc2hvd01vcmU6IGZhbHNlLAogICAgfTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLnByZXBhcmVVc2VyKHsgdXNlcklkOiAidXNlcjUiLCByZWNlaXZlcklkOiAidXNlcjEzMSIgfSk7CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5jb25uZWN0U29ja2V0KCk7CiAgfSwKICB3YXRjaDogewogICAgdXNlcigpIHsKICAgICAgY29uc29sZS5sb2codGhpcy51c2VyKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAogIH0sCiAgY29tcG9uZW50czogewogICAgQ2hhdFJvb21NeVByb2ZpbGUsCiAgICBDaGF0Um9vbU1lc3NhZ2VCb3gsCiAgICBDaGF0Um9vbURhdGVEaXZpZGVyLAogICAgQ2hhdFJvb21NZXNzYWdlSW5wdXQsCiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBwcmVwYXJlVXNlcih7IHVzZXJJZCwgcmVjZWl2ZXJJZCB9KSB7CiAgICAgIHRoaXMudXNlciA9IGF3YWl0IGZldGNoUGFja1VzZXJBbmRNeURhdGEodXNlcklkKTsKICAgICAgdGhpcy5yZWNlaXZlciA9IGF3YWl0IGZldGNoUGFja1VzZXJBbmRNeURhdGEocmVjZWl2ZXJJZCk7CiAgICAgIGNvbnNvbGUubG9nKHRoaXMudXNlci51c2VyLnVzZXJJZCwgdGhpcy5yZWNlaXZlci51c2VyLnVzZXJJZCk7CiAgICB9LAogICAgYWRkU2VudE1lc3NhZ2Uoc2VudE1lc3NhZ2VDb250ZW50KSB7CiAgICAgIGNvbnN0IHsgdXNlcklkIH0gPSB0aGlzLnVzZXIudXNlcjsKICAgICAgY29uc3QgbWF0Y2hJZCA9IDE1OwogICAgICBjb25zdCBtZXNzYWdlID0gewogICAgICAgIG1hdGNoSWQsCiAgICAgICAgdXNlcklkLAogICAgICAgIGNvbnRlbnQ6IHNlbnRNZXNzYWdlQ29udGVudCwKICAgICAgICBjcmVhdGVkRGF0ZTogZGF5anMoKS5mb3JtYXQoIllZWVlNTURESEhtbXNzIiksCiAgICAgIH07CgogICAgICB0aGlzLm1lc3NhZ2VzLnB1c2goewogICAgICAgIC4uLm1lc3NhZ2UsCiAgICAgICAgbWVzc2FnZUlkOiB0aGlzLm1lc3NhZ2VzID8gdGhpcy5tZXNzYWdlcy5sZW5ndGggOiAwLAogICAgICB9KTsKICAgICAgdGhpcy5zdG9tcENsaWVudC5zZW5kKAogICAgICAgIGAvYXBwL2NoYXQuc2VuZE1lc3NhZ2UvJHttYXRjaElkfWAsCiAgICAgICAgSlNPTi5zdHJpbmdpZnkobWVzc2FnZSksCiAgICAgICAge30sCiAgICAgICk7CiAgICB9LAogICAgY29ubmVjdFNvY2tldCgpIHsKICAgICAgY29uc3QgQ0hBVF9UQVJHRVQgPQogICAgICAgICJodHRwOi8vbWF0Y2hpbmcuMTY5LjU2LjEwMC4xMDQubmlwLmlvL3dlYnNvY2tldC1zZXJ2ZXIvd3MiOwogICAgICBjb25zdCBtYXRjaElkID0gMTsKCiAgICAgIGNvbnN0IGNoYXRTb2NrZXQgPSBuZXcgU29ja0pTKENIQVRfVEFSR0VUKTsKCiAgICAgIHRoaXMuc3RvbXBDbGllbnQgPSBTdG9tcC5vdmVyKGNoYXRTb2NrZXQpOwoKICAgICAgY29uc29sZS5sb2coQ0hBVF9UQVJHRVQpOwoKICAgICAgdGhpcy5zdG9tcENsaWVudC5jb25uZWN0KAogICAgICAgIHt9LAogICAgICAgICgpID0+IHsKICAgICAgICAgIHRoaXMuY29ubmVjdGVkID0gdHJ1ZTsKCiAgICAgICAgICB0aGlzLnN0b21wQ2xpZW50LnN1YnNjcmliZShgL3RvcGljLyR7bWF0Y2hJZH1gLCAocmVzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlY2VpdmVkTWVzc2FnZSA9IEpTT04ucGFyc2UocmVzLmJvZHkpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhyZWNlaXZlZE1lc3NhZ2UpOwogICAgICAgICAgICBpZiAocmVjZWl2ZWRNZXNzYWdlLnVzZXJJZCAhPT0gdXNlci51c2VySWQpIHsKICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gocmVjZWl2ZWRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICAoKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZygiRkFJTEVEIik7CiAgICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgIH0sCiAgICAgICk7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAiCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/ChatRoom","sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <ChatRoomMyProfile :user=\"receiver\" />\n    <main>\n      <div class=\"messages\">\n        <div\n          class=\"message-wrapper\"\n          v-for=\"message in this.messages\"\n          :key=\"message.messageId\"\n        >\n          <ChatRoomDateDivider\n            v-if=\"\n              message.messageId === 0 ||\n              messages[message.messageId - 1].createdDate.slice(0, 8) !==\n                message.createdDate.slice(0, 8)\n            \"\n            :date=\"message.createdDate\"\n          />\n          <div class=\"box-wrapper\">\n            <ChatRoomMessageBox\n              :message=\"message\"\n              :onLeft=\"message.userId === receiver.userId\"\n            />\n            <!-- <ChatRoomTimeIndicator :date=\"message.createdDate\" /> -->\n          </div>\n        </div>\n      </div>\n      <ChatRoomMessageInput @sentMessageContent=\"addSentMessage\" />\n    </main>\n  </div>\n</template>\n\n<script>\nimport SockJS from \"sockjs-client\";\nimport Stomp from \"webstomp-client\";\nimport dayjs from \"dayjs\";\n\n// import { prevData, user, receiver } from \"./_worker/api\";\nimport { useUserStore } from \"@/store/states/userState\";\n// import { loadUserAndMyData } from \"@/worker/user\";\n// import { fetchPrevList } from \"./_worker/api\";\n// import { prepareUser } from \"./_worker/user\";\nimport { fetchPackUserAndMyData } from \"./_worker/user\";\nimport ChatRoomMyProfile from \"./_components/ChatRoomMyProfile.vue\";\nimport ChatRoomDateDivider from \"./_components/ChatRoomDateDivider.vue\";\nimport ChatRoomMessageBox from \"./_components/ChatRoomMessageBox.vue\";\nimport ChatRoomMessageInput from \"./_components/ChatRoomMessageInput.vue\";\n// import { fetchMyData, fetchUser } from \"../../worker/user\";\n// import ChatRoomTimeIndicator from \"./_components/ChatRoomTimeIndicator.vue\";\n\nexport default {\n  name: \"ChatRoom\",\n  setup() {\n    const store = useUserStore();\n    return { store };\n  },\n  data() {\n    return {\n      // dummyTurn: 0,\n      // dummyId: prevData.length,\n      messages: [],\n      user: {},\n      receiver: {},\n      showMore: false,\n    };\n  },\n  mounted() {\n    this.prepareUser({ userId: \"user5\", receiverId: \"user131\" });\n  },\n  created() {\n    this.connectSocket();\n  },\n  watch: {\n    user() {\n      console.log(this.user);\n      return null;\n    },\n  },\n  components: {\n    ChatRoomMyProfile,\n    ChatRoomMessageBox,\n    ChatRoomDateDivider,\n    ChatRoomMessageInput,\n  },\n  methods: {\n    async prepareUser({ userId, receiverId }) {\n      this.user = await fetchPackUserAndMyData(userId);\n      this.receiver = await fetchPackUserAndMyData(receiverId);\n      console.log(this.user.user.userId, this.receiver.user.userId);\n    },\n    addSentMessage(sentMessageContent) {\n      const { userId } = this.user.user;\n      const matchId = 15;\n      const message = {\n        matchId,\n        userId,\n        content: sentMessageContent,\n        createdDate: dayjs().format(\"YYYYMMDDHHmmss\"),\n      };\n\n      this.messages.push({\n        ...message,\n        messageId: this.messages ? this.messages.length : 0,\n      });\n      this.stompClient.send(\n        `/app/chat.sendMessage/${matchId}`,\n        JSON.stringify(message),\n        {},\n      );\n    },\n    connectSocket() {\n      const CHAT_TARGET =\n        \"http://matching.169.56.100.104.nip.io/websocket-server/ws\";\n      const matchId = 1;\n\n      const chatSocket = new SockJS(CHAT_TARGET);\n\n      this.stompClient = Stomp.over(chatSocket);\n\n      console.log(CHAT_TARGET);\n\n      this.stompClient.connect(\n        {},\n        () => {\n          this.connected = true;\n\n          this.stompClient.subscribe(`/topic/${matchId}`, (res) => {\n            const receivedMessage = JSON.parse(res.body);\n            console.log(receivedMessage);\n            if (receivedMessage.userId !== user.userId) {\n              this.messages.push(receivedMessage);\n            }\n          });\n        },\n        () => {\n          console.log(\"FAILED\");\n          this.connected = false;\n        },\n      );\n    },\n  },\n};\n</script>\n\n<style scoped>\n.wrapper {\n  width: 100vw;\n  height: 100%;\n  overflow: hidden;\n}\n\nmain {\n  height: calc(100% - 58px);\n  overflow-y: scroll;\n}\n\n.message-wrapper {\n  width: 90%;\n  margin: 0 auto;\n}\n\n.messages {\n  height: calc(100% - 126px);\n}\n\nh1 {\n  margin: 7px 0;\n}\n</style>\n"]}]}